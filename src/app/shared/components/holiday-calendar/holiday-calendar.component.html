<mat-card class="calendar-card">
    <mat-card-header>
        <mat-card-title>Calendário de Feriados</mat-card-title>
        <mat-card-subtitle>Clique em um dia para adicionar um evento</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
        <div class="controls">
            <mat-form-field>
                <mat-label>Ano</mat-label>
                <mat-select [formControl]="yearControl">
                    <mat-option *ngFor="let year of yearRange" [value]="year">
                        {{ year }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field>
                <mat-label>Estado</mat-label>
                <mat-select [formControl]="stateControl">
                    <mat-option value="">Todos (Feriados Nacionais)</mat-option>
                    <mat-option *ngFor="let state of states" [value]="state.value">
                        {{ state.label }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div *ngIf="loading" class="loading">
            <mat-spinner diameter="40"></mat-spinner>
            <span>Carregando feriados...</span>
        </div>

        <div *ngIf="error" class="error">
            <mat-icon color="warn">error</mat-icon>
            {{ error }}
        </div>

        <div class="calendar-container">
            <div *ngFor="let month of [0,1,2,3,4,5,6,7,8,9,10,11]" class="month-container">
                <h3>{{ getMonthName(month) }} {{ yearControl.value }}</h3>
                <table class="calendar-table">
                    <thead>
                        <tr>
                            <th *ngFor="let day of ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb']">{{ day }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let week of getWeeksInMonth(yearControl.value ?? currentYear, month)">
                            <td *ngFor="let day of week" 
                            [class.holiday]="day.getTime() !== 0 && isHoliday(day)"
                            [class.has-event]="day.getTime() !== 0 && getEventsForDate(day).length > 0"
                            (dblclick)="onDayClick(day)">
                        
                            <div class="day-cell">
                                <span *ngIf="day.getTime() !== 0">{{ day.getDate() }}</span>
                                
                                <!-- Ícone de feriado centralizado acima -->
                                <mat-icon *ngIf="day.getTime() !== 0 && isHoliday(day)" class="holiday-icon">
                                    celebration
                                </mat-icon>
                                
                                <!-- Ícone de evento centralizado abaixo -->
                                <mat-icon *ngIf="day.getTime() !== 0 && getEventsForDate(day).length > 0" class="event-icon">
                                    event_available
                                </mat-icon>
                                
                                <!-- Tooltip -->
                                <div class="custom-tooltip" *ngIf="day.getTime() !== 0">
                                    {{ getHolidayTooltip(day) }}
                                  </div>
                            </div>
                        </td>
                        </tr>
                      </tbody>
                      
                </table>
            </div>
        </div>


        <div class="events-section" *ngIf="events().length > 0">
            <h3>Eventos Agendados</h3>
            <mat-list>
                <mat-list-item *ngFor="let event of sortedEvents()" class="event-list-item">
                    <mat-icon matListIcon color="primary">event</mat-icon>
                    <div mat-line class="event-date">{{ event.date | date:'dd/MM/yyyy' }}</div>
                    <div mat-line class="event-title">{{ event.title }}</div>

                    <button mat-icon-button [matMenuTriggerFor]="menu" class="event-menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>

                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="openEventDialog(event.date, event)">
                            <mat-icon>edit</mat-icon>
                            <span>Editar</span>
                          </button>
                        <button mat-menu-item (click)="deleteEvent(event)">
                            <mat-icon>delete</mat-icon>
                            <span>Excluir</span>
                        </button>
                    </mat-menu>
                </mat-list-item>
            </mat-list>
        </div>
    </mat-card-content>
</mat-card>